<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <title>Dark Mode Dashboard</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@23,400,0,0&icon_names=menu">
	<style>
		body {
			/* background-color: #343a40; */
			font-family: 'montserrat', sans-serif;
		}

		a {
			text-decoration: none;
		}
	</style>
</head>
<body>
    <div id="main" class="d-flex">
		<button class="btn d-sm-none align-self-start" style="width: 20px;" type="button" data-bs-toggle="offcanvas" data-bs-backdrop="false" data-bs-target="#offcanvasResponsive" aria-controls="offcanvasResponsive">
			<span class="material-symbols-outlined position-relative top-0">menu</span>
		</button>
		<nav class="offcanvas-sm offcanvas-start p-3" style="width: 170px; height: 100vh; background-color: #1B263B;" tabindex="-1" id="offcanvasResponsive" aria-labelledby="offcanvasResponsiveLabel">
            <div class="offcanvas-body-sm">
				<h2 class="offcanvas-title mb-4 lh-1"><a href="/">Product Tracker</a></h2>
				<form method="POST" action="{{ url_for('add_product')}}">
					<div class="form-group">
						<label for="name">Product Name</label>
						<input type="text" class="form-control" id="name" name="name" required autocomplete="name">
					</div>
					<div class="form-group">
						<label for="category">Category</label>
						<input name="category" class="form-control" list="datalistOptions" id="category" required>
						<datalist id="datalistOptions">
							{% for category in categories %}
								<option value="{{ category.name }}">
							{% endfor %}
						</select>
					</div>
					<div class="form-group">
						<label for="price">Price</label>
						<input type="number" class="form-control" id="price" name="price" required step="0.01" min="0" placeholder="R$0.00">
					</div>
					<div class="form-group">
						<label for="date">Purchase Date</label>
						<input type="date" class="form-control" id="date" name="date" required>
					</div>
					<div class="form-group mt-2">
						<button type="submit" class="btn btn-primary">Add Product</button>
					</div>
				</form>
			</div>
            <hr>
		</nav>

		<div class="text-center mx-auto p-1 pt-5" style="width: 100%; background-color: #0D1B2A;">
			<div class="container-sm text-start pb-4" style="height: 250px; width: 335px;">
				{% if selected_product %}
					<h2 class="pb-4 text-center">Product Details</h2>
					<h4>{{ selected_product.name.capitalize() }}</h3>
					<p>Category: {{ selected_product.category }}</p>
					<p>Price: {{ brl(selected_product.price) }}</p>
					<p>Average Days Between Purchases: {{ avg_days }} days</p>
				{% else %}
					<div class="text-center">
						<h2>Product Details</h2>
						<p>Select a product to see details.</p>
					</div>
				{% endif %}
			</div>

			<div class="mt-4 mx-auto" style="width: 335px;">
				<h4>Product History</h4>
				<ul id="product-list" class="list-group">
					{% if products %}
						{% for product in products %}
							<li class="bg-info-subtle d-flex list-group-item pb-2 pe-0">
								<div class="w-100 text-start">
									<a href="{{ url_for('product', id=product.hist_id) }}" class="text-body">
										<div class="row">
											<div class="col w-100 text-info">Name: {{ product.name.capitalize() }}</div>
											<div class="col text-end">{{ date_format("%d/%m/%Y", product.t_date) }}</div>
										</div>
										<div class="row">
											<div class="col-auto">Category: {{ product.category }}</div>
											<div class="col text-end">Price: {{ brl(product.price) }}</div>
										</div>
									</a>
								</div>
								<div>
									<button name="edit" value="{{ product.hist_id }}" class="btn p-2 pb-0 pt-2" data-bs-toggle="modal" data-bs-target="#modal" data-bs-name="{{ product.name.capitalize() }}">
										<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h357l-80 80H200v560h560v-278l80-80v358q0 33-23.5 56.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12 27-18t30-6q16 0 30.5 6t26.5 18l56 57q11 12 17 26.5t6 29.5q0 15-5.5 29.5T897-728L530-360H360Zm481-424-56-56 56 56ZM440-440h56l232-232-28-28-29-28-231 231v57Zm260-260-29-28 29 28 28 28-28-28Z"/></svg>
									</button>

									<!-- modal -->
									<div class="modal fade" id="modal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
										<div class="modal-dialog">
											<div class="modal-content">
												<div class="modal-header">
													<h1 class="modal-title fs-5" id="modalLabel">modal title</h1>
													<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
												</div>
												<div class="modal-body">
													body
												</div>
											</div>
										</div>
									</div>
								</div>
							</li>
						{% endfor %}
					{% else %}
							<li>No Products</li>
					{% endif %}
				</ul>
			</div>
		</div>
    </div>

  	<script>
      	const modal = document.getElementById('modal')
		if (modal) {
			modal.addEventListener('show.bs.modal', event => {
				// Button that triggered the modal
				const button = event.relatedTarget

				const product = button.getAttribute('data-bs-name')

				// Update the modal's content.
				const modalTitle = modal.querySelector('.modal-title')
				const modalBodyInput = modal.querySelector('.modal-body')
				const productId = button.value


				htmlForm = fetch(`/edit/${productId}`)
				.then(response => response.text())
				.then(html => {
					modalBodyInput.innerHTML = html
				})

				modalTitle.textContent = `Edit ${product}`

			})
		}
	</script>
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
